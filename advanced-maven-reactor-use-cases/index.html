<!doctype html><html dir=ltr lang=en data-theme=dark><head><title>Martin Kanters | Advanced Maven Reactor use cases</title><meta charset=utf-8><meta name=generator content="Hugo 0.81.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="occassionally blogs about 
his tech endeavours
"><link rel=stylesheet href=/css/main.min.f79a5de55310cc058fc81804d033ddb955937d778bd533d9ea05b1c798501013.css integrity="sha256-95pd5VMQzAWPyBgE0DPduVWTfXeL1TPZ6gWxx5hQEBM=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.f5ed99b80955c515bb08caad52244ac809cf722864a190061a2e78f5211ca770.css integrity="sha256-9e2ZuAlVxRW7CMqtUiRKyAnPcihkoZAGGi549SEcp3A=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=/advanced-maven-reactor-use-cases/><script type=text/javascript src=/js/anatole-header.min.0c05c0a90d28c968a1cad4fb31abd0b8e1264e788ccefed022ae1d3b6f627514.js integrity="sha256-DAXAqQ0oyWihytT7MavQuOEmTniMzv7QIq4dO29idRQ=" crossorigin=anonymous></script><script type=text/javascript src=/js/anatole-theme-switcher.min.7fd87181cdd7e8413aa64b6867bb32f3a8dc242e684fc7d5bbb9f600dbc2b6eb.js integrity="sha256-f9hxgc3X6EE6pktoZ7sy86jcJC5oT8fVu7n2ANvCtus=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Advanced Maven Reactor use cases"><meta name=twitter:description content="For all folks using Maven, and especially those who use multi module projects, Maven 4 will be a treat for you. I had the opportunity to work together with @mthmulders on several issues and bug fixes around the Maven reactor. The reactor is the backbone of multi module projects in Maven. Most of the things you need to know about the reactor are documented here. In this article I would like to show you the real advanced use cases."></head><body><div class="sidebar animated fadeInDown"><div class=logo-title><div class=title><img src=/images/avatar.png alt="profile picture"><h3 title><a href=/>Martin Kanters</a></h3><div class=description><p>occassionally blogs about<br>his tech endeavours<br></p></div></div></div><ul class=social-links><li><a href=https://github.com/MartinKanters rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=https://twitter.com/MartinKanters rel=me aria-label=Twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:mail@martinkanters.dev rel=me aria-label=E-Mail><i class="fas fa-at fa-2x" aria-hidden=true></i></a></li><li><a href=https://www.linkedin.com/in/martinkanters/ rel=me aria-label=LinkedIn><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Martin Kanters 2021</div></div></div><div class=main><div class="page-top animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a href=/ title>Home</a></li><li><a href=/posts/ title>Posts</a></li><li><a href=/about/ title>About</a></li><li class=theme-switch-item><a class=theme-switch title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post animated fadeInDown"><div class=post-content><div class=post-title><h3>Advanced Maven Reactor use cases</h3></div><p>For all folks using Maven, and especially those who use multi module projects, Maven 4 will be a treat for you.
I had the opportunity to work together with <a href=https://twitter.com/mthmulders>@mthmulders</a> on several issues and bug fixes around the Maven reactor.
The reactor is the backbone of multi module projects in Maven.
Most of the things you need to know about the reactor are <a href=https://maven.apache.org/guides/mini/guide-multiple-modules-4.html>documented here</a>.
In this article I would like to show you the real advanced use cases.
It&rsquo;s a collection of use cases of which some are useful, some are rarely needed and some are just so exotic you should question yourself what you are actually doing.</p><h1 id=maven-reactor>Maven Reactor</h1><p>In Maven, you can control most of how Maven builds multi module projects using CLI flags.
The use cases you will find below are based on the combination of those flags.
First, a short summary of the relevant ones (taken from the <a href=https://maven.apache.org/guides/mini/guide-multiple-modules-4.html>original docs</a>):</p><table><thead><tr><th style=text-align:left>Long</th><th style=text-align:left>Short</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>--file</code></td><td style=text-align:left><code>-f</code></td><td>Selects an alternative POM file or directory containing a POM file.</td></tr><tr><td style=text-align:left><code>--projects</code></td><td style=text-align:left><code>-pl</code></td><td>Specifies the modules to include or exclude from a build.</td></tr><tr><td style=text-align:left><code>--also-make</code></td><td style=text-align:left><code>-am</code></td><td>Builds the specified modules, and any of their dependencies in the reactor.</td></tr><tr><td style=text-align:left><code>--also-make-dependents</code></td><td style=text-align:left><code>-amd</code></td><td>Builds the specified modules, and any that depend on them.</td></tr><tr><td style=text-align:left><code>--resume-from</code></td><td style=text-align:left><code>-rf</code></td><td>Resumes a reactor from the specified project (e.g. when it fails in the middle).</td></tr><tr><td style=text-align:left><code>--resume</code></td><td style=text-align:left><code>-r</code></td><td>Resumes a reactor from the module where the previous build failed.</td></tr></tbody></table><h1 id=project-structure>Project structure</h1><p>The use cases will take the following project structure in mind.
To keep it easy, the project structure is equal to the one from the <a href=https://maven.apache.org/guides/mini/guide-multiple-modules-4.html>original docs</a>.</p><p><img src=/images/posts/maven-reactor-advanced-use-cases-project.png alt="Multi module project structure" title="Multi module project structure"></p><p>The upcoming use cases are based on the <a href=https://github.com/apache/maven/blob/master/maven-core/src/test/java/org/apache/maven/graph/DefaultGraphBuilderTest.java#L73>unit tests from Maven itself</a>.
Important to note is the project order. That is calculated based on the dependencies within the project and the order in POM, in this case it is the following:<br><code>parent</code>, <code>module-c</code>, <code>module-c-1</code>, <code>module-a</code>, <code>module-b</code> and <code>module-c-2</code>.</p><p>You can find the <a href=https://github.com/MartinKanters/maven-4-reactor-example/tree/maven-unit-test-module-order>test project on GitHub</a>.</p><h1 id=use-cases>use cases</h1><h2 id=1-building-modules-with-their-relevant-inter-project-dependencies>1. Building modules with their relevant inter-project dependencies</h2><p>We start off simple.
This is most likely one of the more common and useful scenarios.</p><p>When working on big multi module projects, some developers have grown custom to get coffee every time the project builds.
Usually there is plenty of time, after all!
Even if only one module changed, they do that.
But, among other reasons (such as taking care of their caffeine levels), people should use certain CLI flags to optimize this process.</p><p>A single module can easily be built by using the <code>-f</code> or <code>-pl</code> flags.
But, modules in a project often depend on others&mldr; which also should be rebuilt to include the newly built module.</p><p>Maven luckily can easily take care of that for you: <code>-am</code> and <code>-amd</code> are created for that.</p><h3 id=examples>Examples</h3><ol><li><p><code>mvn validate -pl :module-c-2 -am</code><br>results in Maven building <code>parent</code>, <code>module-c</code>, <code>module-a</code>, <code>module-b</code> and finally <code>module-c-2</code>.</p></li><li><p><code>mvn validate -pl :module-b -amd</code><br>results in Maven building <code>module-b</code> and then <code>module-c-2</code>.</p></li></ol><h2 id=2-build-all-needed-modules-except-for-the-module-itself>2. Build all needed modules, except for the module itself</h2><p>Among others, Gunnar Morling <a href=https://twitter.com/gunnarmorling/status/1463792047316520965>asked on Twitter</a> whether it&rsquo;s possible to run all tests for a specific module, but before that, build all of its needed dependencies. As we learned in use case #1, the goal (like <code>compile</code> or <code>test</code>) is ran for every module in the reactor, but he requested to only run the tests for the specified module.</p><p>One option is to create a profile for this, skipping the test goal for all modules except the specific one. But Gunnar mentioned that he would like to be flexible, so profiles will not work. Another option is to specify in the CLI flags to just run tests in a certain package. This is possible, but you would need to have specific packages per dependency (which is a good idea anyway), but also have to remember them from heart when running the command&mldr;</p><p>Unfortunately it&rsquo;s not possible to solve this in one Maven invocation, but customizing the reactor definitely helps.
We can make use of the fact that Maven first selects all modules into the reactor before it removes unwanted modules.</p><h3 id=examples-1>Examples</h3><ol><li><code>mvn compile -pl :module-b,!:module-b -am && mvn test -pl :module-b</code><br>results in the first Maven invocation to compile <code>parent</code> and <code>module-a</code> and the second to test <code>module-b</code>.</li></ol><h2 id=3-excluding-the-module-we-are-resuming-from>3. Excluding the module we are resuming from</h2><p>When a multi module project fails building somewhere halfway, Maven 3 shows a hint how to continue the build:</p><pre><code>[ERROR] After correcting the problems, you can resume the build with the command
[ERROR]   mvn &lt;args&gt; -rf :&lt;artifact-id&gt;
</code></pre><p>In Maven 4, Maven keeps a record of the last failed module and allows you to resume the build from the last failed module using just <code>mvn &lt;args> -r</code>.</p><p>But this use case is not about that, because that would not be an advanced scenario.
This one is about skipping the failed module and continuing the rest of the build.
While I can imagine some scenarios where it can be useful, if the module is used as a dependency from later modules, this is discouraged.
It could result in the later module including an old artifact from the local repository as dependency.</p><h3 id=examples-2>Examples</h3><ol><li><p><code>mvn validate -rf :module-b -pl !:module-b</code><br>results in Maven building just <code>module-c-2</code>.</p></li><li><p><em>(Assuming <code>module-b</code> failed in an earlier run)</em><br><code>mvn validate -r -pl !:module-b</code><br>results in Maven building just <code>module-c-2</code>.</p></li></ol><h2 id=4-excluding-a-module-activated-by-also-make-does-take-its-transitive-dependencies>4. Excluding a module activated by also-make does take its transitive dependencies</h2><p>It gets trickier here.</p><p>Remember that <code>--also-make</code> or <code>-am</code> also builds all inter-module dependencies of a selected module?
Because the reactor first handles including modules (in several ways), and finally excludes modules, it&rsquo;s possible to exclude a dependency in the transitive (multi module) dependency graph.
The examples below expand on the first example of use case 1 (combining <code>-pl</code> and <code>-am</code>).</p><p>Now, why this is useful&mldr; I don&rsquo;t know. I haven&rsquo;t encountered a valid use case for it yet.
But since Maven is used in so many different forms, I&rsquo;m sure it&rsquo;s useful somewhere!</p><h3 id=examples-3>Examples</h3><ol><li><p><code>mvn validate -pl :module-c-2,!:module-b -am</code><br>results in Maven building <code>parent</code>, <code>module-c</code>, <code>module-a</code> and finally <code>module-c-2</code>.</p></li><li><p><code>mvn validate -rf :module-c-2 -pl !:module-b -am</code><br>also results in Maven building <code>parent</code>, <code>module-c</code>, <code>module-a</code> and finally <code>module-c-2</code>.</p></li></ol><h1 id=conclusion>Conclusion</h1><p>In this article I showed you how to combine several CLI flags to unlock advanced behavior in the Maven reactor.
Even though it might not be applicable directly, perhaps it helped you understand the way how the Maven parses the flags.
All of these exotic cases, but also the usual ones, are <a href=https://github.com/apache/maven/blob/master/maven-core/src/test/java/org/apache/maven/graph/DefaultGraphBuilderTest.java#L73>covered in unit tests</a>, which should be pretty easy to interpret.
Can you find other exotic ones?</p><p>I have pushed the <a href=https://github.com/MartinKanters/maven-4-reactor-example/tree/maven-unit-test-module-order>test project to GitHub</a>.
All examples from above should work there when run with Maven 4.
Please let us know if we are still missing test cases!
Either in a PM, JIRA issue or a direct PR ;)</p></div><div class=post-footer><div class=info></div></div></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.83cb1dd5fea8d42d87d1e601a07faa73089ad0ef9ccfe5daf6041289ebcc4e46.js integrity="sha256-g8sd1f6o1C2H0eYBoH+qcwia0O+cz+Xa9gQSievMTkY=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-XVJ8L7CN7V"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-XVJ8L7CN7V')</script></body></html>